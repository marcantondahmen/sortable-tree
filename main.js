/*! For license information please see main.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SortableTree=t():e.SortableTree=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>m});const n=(e,t=[],n={},o=null)=>{const r=document.createElement(e);t.forEach((e=>{r.classList.add(e)}));for(const[e,t]of Object.entries(n))r.setAttribute(e,t);return o&&o.appendChild(r),r};class o extends HTMLElement{set label(e){this._label=e}get label(){return this._label}set subnodes(e){this._nodes=e}get subnodes(){return this._nodes}constructor(){super()}connectedCallback(){this.setAttribute("id",(()=>{const e=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`})()),this.setAttribute("draggable","true")}}o.TAG_NAME="tree-node";const r=({node:e,eventName:t,handler:n,tree:o})=>{e.addEventListener(t,(e=>{n(e,o)}),!1)};var s;!function(e){e.BEFORE="BEFORE",e.INSIDE="INSIDE",e.AFTER="AFTER"}(s||(s={}));const d=e=>{const t=e.clientY,n=a(e).label.getBoundingClientRect(),o=Math.round(n.height/4);return n.top+o>t?s.BEFORE:n.bottom-o<t?s.AFTER:s.INSIDE},a=e=>e.target.closest(o.TAG_NAME),l=(e,t)=>{a(e).classList.remove(t.styles.nodeDropAfter,t.styles.nodeDropBefore,t.styles.nodeDropInside)},i=(e,t)=>{e.stopPropagation(),e.dataTransfer.setData("text",e.target.id),e.dataTransfer.effectAllowed="move"},c=(e,t)=>{e.stopPropagation(),e.preventDefault(),l(e,t);const n=a(e);if(!n)return!1;const r=e.dataTransfer.getData("text"),i=d(e),c=document.getElementById(r);if(c.contains(n))return!1;if(t.lockRootLevel&&!n.parentElement.closest(o.TAG_NAME)&&(i===s.BEFORE||i===s.AFTER))return!1;if(i===s.BEFORE)return n.parentNode.insertBefore(c,n),t.onDrop(c,n.parentElement.parentElement),!1;if(i===s.AFTER){const e=n.nextElementSibling;return e?(n.parentNode.insertBefore(c,e),t.onDrop(c,n.parentElement.parentElement)):(n.parentNode.appendChild(c),t.onDrop(c,n.parentElement.parentElement)),!1}return n.subnodes.appendChild(c),t.onDrop(c,n),!1},p=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",((e,t)=>{const n=a(e),o=d(e);n.classList.toggle(t.styles.nodeDropBefore,o===s.BEFORE),n.classList.toggle(t.styles.nodeDropInside,o===s.INSIDE),n.classList.toggle(t.styles.nodeDropAfter,o===s.AFTER)})(e,t)},f=(e,t)=>{l(e,t)},u=(e,t)=>{l(e,t)},E=e=>e.text,h={tree:"tree",node:"tree__node",nodeHover:"tree__node--hover",nodeDropBefore:"tree__node--drop-before",nodeDropInside:"tree__node--drop-inside",nodeDropAfter:"tree__node--drop-after",label:"tree__label",subnodes:"tree__subnodes"},b=e=>{console.log(e)},m=class{constructor({nodes:e,element:t,renderLabel:n,styles:o,lockRootLevel:r,onChange:s}){this.defineElements(),this.root=t,this.styles=Object.assign(h,o),this.renderLabel=n||E,this.lockRootLevel=void 0===r||r,this.onChange=s||b,t.classList.add(this.styles.tree),this.render({nodes:e,element:t})}defineElements(){try{customElements.define(o.TAG_NAME,o)}catch(e){}}render({nodes:e,element:t}){e.forEach((e=>{const s=n(o.TAG_NAME,[this.styles.node],e.attributes,t),d=n("div",[this.styles.label],{},s),a=n("div",[this.styles.subnodes],{},s);s.label=d,s.subnodes=a,d.innerHTML=this.renderLabel(e),((e,t)=>{const n={dragstart:i,drop:c,dragover:p,dragend:u,dragleave:f};for(const[o,s]of Object.entries(n))r({node:e,eventName:o,handler:s,tree:t})})(s,this),e.nodes&&this.render({nodes:e.nodes,element:a})}))}parseTree(e){const t=Array.from(e.querySelectorAll(`:scope > ${o.TAG_NAME}`)),n=[];return t.forEach((e=>{n.push({element:e,id:e.id,subnodes:this.parseTree(e.subnodes)})})),n}onDrop(e,t){const n={nodes:this.parseTree(this.root),moved:e,parent:t};this.onChange(n)}};return t.default})()));