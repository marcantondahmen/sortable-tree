/*! Sortable Tree 0.5.1, (c) 2023 Marc Anton Dahmen, MIT license */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SortableTree=t():e.SortableTree=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>C});var o=function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))};const n=e=>`<span>${e.title}</span>`,r={tree:"tree",node:"tree__node",nodeHover:"tree__node--hover",nodeDragging:"tree__node--dragging",nodeDropBefore:"tree__node--drop-before",nodeDropInside:"tree__node--drop-inside",nodeDropAfter:"tree__node--drop-after",label:"tree__label",subnodes:"tree__subnodes",collapse:"tree__collapse"},s=({nodes:e,movedNode:t,srcParentNode:n,targetParentNode:r})=>o(void 0,void 0,void 0,(function*(){})),i=(e,t)=>o(void 0,void 0,void 0,(function*(){})),a=(e,t)=>o(void 0,void 0,void 0,(function*(){return!0}));const l=(e,t=[],o=null)=>{const n=document.createElement(e);return t.forEach((e=>{n.classList.add(e)})),o&&o.appendChild(n),n},d=()=>((e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),""))();class c extends HTMLElement{static create({data:e,renderLabel:t,styles:o,parent:n,onClick:r,draggable:s}){const i=l(c.TAG_NAME,[o.node],n),a=l("div",[o.label],i),d=l("div",[o.subnodes],i),u=l("span",[o.collapse],i);return a.innerHTML=t(e),u.innerHTML=C.ICON_COLLAPSED,u.addEventListener("click",i.toggle.bind(i)),a.addEventListener("click",(e=>{r(e,i)})),s&&i.setAttribute("draggable","true"),i._data=e,i._label=a,i._nodes=d,i.collapseButton=u,i}get data(){return this._data}get label(){return this._label}get subnodes(){return this._nodes}get subnodesData(){const e=[];return Array.from(this._nodes.children).forEach((t=>{e.push(t.data)})),e}get id(){return this._id}constructor(){super(),this._id=d()}collapse(e){e?(this.removeAttribute("open"),this.collapseButton.innerHTML=C.ICON_COLLAPSED):(this.setAttribute("open","true"),this.collapseButton.innerHTML=C.ICON_OPEN)}toggle(){this.collapse(this.hasAttribute("open"))}reveal(){((e,t)=>{const o=[];let n=t.closest(e);for(;null!==n;)o.push(n),n=n.parentNode.closest(e);return o})(c.TAG_NAME,this).forEach((e=>{e.collapse(!1)}))}}c.TAG_NAME="sortable-tree-node";var u=function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))};const h=({node:e,eventName:t,handler:o,tree:n})=>{e.addEventListener(t,(e=>{o(e,n)}),!1)};var p;!function(e){e.BEFORE="BEFORE",e.INSIDE="INSIDE",e.AFTER="AFTER"}(p||(p={}));const f=e=>{const t=e.clientY,o=g(e).label.getBoundingClientRect(),n=Math.round(o.height/4);return o.top+n>t?p.BEFORE:o.bottom-n<t?p.AFTER:p.INSIDE},g=e=>e.target.closest(c.TAG_NAME),v=e=>{const t=null==e?void 0:e.parentElement.parentElement;return(null==t?void 0:t.tagName.toLowerCase())!==c.TAG_NAME?null:t},b=(e,t)=>{g(e).classList.remove(t.styles.nodeDropAfter,t.styles.nodeDropBefore,t.styles.nodeDropInside)},E=(e,t)=>{e.stopPropagation();const o=e.target;o.tagName.toLowerCase()===c.TAG_NAME&&(e.dataTransfer.setData("text",o.id),e.dataTransfer.effectAllowed="move",o.classList.add(t.styles.nodeDragging))},m=(e,t)=>u(void 0,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault(),b(e,t);const o=g(e);if(!o)return!1;const n=v(o),r=e.dataTransfer.getData("text"),s=f(e),i=t.getNode(r);if(!i||(null==i?void 0:i.contains(o)))return!1;const a=v(i);if(t.lockRootLevel&&!(null==o?void 0:o.parentElement.closest(c.TAG_NAME))&&(s===p.BEFORE||s===p.AFTER))return!1;if(s===p.BEFORE)return!!(yield t.confirm(i,n))&&(o.parentNode.insertBefore(i,o),t.onDrop(i,a,n),!1);if(s===p.AFTER){if(!(yield t.confirm(i,n)))return!1;const e=o.nextElementSibling;return e?(o.parentNode.insertBefore(i,e),t.onDrop(i,a,n)):(o.parentNode.appendChild(i),t.onDrop(i,a,n)),!1}return!!(yield t.confirm(i,o))&&(o.subnodes.appendChild(i),t.onDrop(i,a,o),!1)})),_=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",((e,t)=>{const o=g(e),n=f(e);o.classList.toggle(t.styles.nodeDropBefore,n===p.BEFORE),o.classList.toggle(t.styles.nodeDropInside,n===p.INSIDE),o.classList.toggle(t.styles.nodeDropAfter,n===p.AFTER)})(e,t)},A=(e,t)=>{b(e,t)},N=(e,t)=>{e.target.classList.remove(t.styles.nodeDragging),b(e,t)},y=e=>`sortableTreeState-${e.replace(/[^\w]+/,"-")}`;class L{constructor({nodes:e,element:t,renderLabel:o,styles:l,lockRootLevel:d,onChange:c,onClick:u,initCollapseLevel:h,confirm:p,disableSorting:f,stateId:g}){this.nodeCollection={},e&&(t?(this.defineElements(),this.root=t,this.styles=Object.assign(r,l),this.renderLabel=o||n,this.lockRootLevel=void 0===d||d,this.onChange=c||s,this.onClick=u||i,this.confirm=p||a,this.initCollapseLevel=void 0===h?2:h,this.disableSorting=f||!1,t.classList.add(this.styles.tree),this.render({nodes:e,element:t}),g&&(((e,t)=>{const o=sessionStorage.getItem(y(e));if(!o)return;const n=JSON.parse(o),r=(e,t)=>{const[o,n]=t;e.element.collapse(0===o),n&&e.subnodes.forEach(((e,t)=>{void 0!==n[t]&&r(e,n[t])}))};t.forEach(((e,t)=>{r(e,n[t])}))})(g,this.parseTree(this.root)),this.initStateObserver(g))):console.error('Error: "element" is not a valid HTML element!'))}getNode(e){return this.nodeCollection[e]}findNode(e,t){const o=Object.values(this.nodeCollection);for(let n=0;n<o.length;n++){const r=o[n],s=r.data;if(e in s&&s[e]==t)return r}return null}onDrop(e,t,o){const n={nodes:this.parseTree(this.root),movedNode:e,srcParentNode:t,targetParentNode:o};o.collapse(!1),this.onChange(n)}destroy(){this.observer.disconnect(),this.observer=null}initStateObserver(e){const t=new MutationObserver((()=>{((e,t)=>{const o=[],n=e=>{const t=[],o=[e.element.getAttribute("open")?1:0,t];return e.subnodes.forEach((e=>{t.push(n(e))})),o};t.forEach((e=>{o.push(n(e))})),sessionStorage.setItem(y(e),JSON.stringify(o))})(e,this.parseTree(this.root))}));t.observe(this.root,{childList:!0,attributes:!0,subtree:!0})}defineElements(){try{customElements.define(c.TAG_NAME,c)}catch(e){}}render({nodes:e,element:t},o=0){o++,e.forEach((e=>{const n=c.create({styles:this.styles,parent:t,renderLabel:this.renderLabel,data:e.data,onClick:this.onClick,draggable:!this.disableSorting});this.disableSorting||((e,t)=>{const o={dragstart:E,drop:m,dragover:_,dragend:N,dragleave:A};for(const[n,r]of Object.entries(o))h({node:e,eventName:n,handler:r,tree:t})})(n,this),n.collapse(o>this.initCollapseLevel),this.nodeCollection[n.id]=n,e.nodes&&this.render({nodes:e.nodes,element:n.subnodes},o)}))}parseTree(e){const t=Array.from(e.querySelectorAll(`:scope > ${c.TAG_NAME}`)),o=[];return t.forEach((e=>{o.push({element:e,id:e.id,subnodes:this.parseTree(e.subnodes)})})),o}}L.ICON_COLLAPSED='<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16"><path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/></svg>',L.ICON_OPEN='<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>';const C=L;return t=t.default})()));